# Hello World OSGi Config Project

This project demonstrates how to apply environment specific configuration in AEM without the use of [run modes](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/configure-runmodes.html). 

Instead, a package is generated by passing in the desired run mode at build time and only the desired configuration is copied across
to the generated artifact.

Specify the OSGi configuration like so:
```
└── apps
    └── config-helloworld
        ├── config
        │   └── org.apache.sling.commons.log.LogManager.factory.config-helloworld.xml
        ├── config.author
        │   └── com.day.cq.wcm.mobile.core.impl.MobileEmulatorProvider-helloworld.xml
        ├── config.author.dev
        │   └── com.adobe.acs.commons.wcm.impl.AemEnvironmentIndicatorFilter.xml
        └── config.author.prod
            └── com.adobe.acs.commons.wcm.impl.AemEnvironmentIndicatorFilter.xml
```

When passing the `runmode=dev` system property, the following package is generated:
```
└── apps
    └── config-helloworld
        ├── config
        │   └── org.apache.sling.commons.log.LogManager.factory.config-helloworld.xml
        └── config.author
            ├── com.adobe.acs.commons.wcm.impl.AemEnvironmentIndicatorFilter.xml
            └── com.day.cq.wcm.mobile.core.impl.MobileEmulatorProvider-helloworld.xml
```

An additional package for production can be created by using `runmode=prod`.

> This project is setup to use System properties but it could easily be changed to make use of Environment variables 
by changing the POM to read the runmode value using `${env.runmode}`.

## How to build

To build all the modules run in the project root directory the following command with Maven 3:

    mvn clean install -Drunmode=<runmode>

If you have a running AEM instance you can build and package the whole project and deploy into AEM with  

    mvn clean install -PautoInstallPackage -Drunmode=<runmode>
    
Or to deploy it to a publish instance, run

    mvn clean install -PautoInstallPackagePublish -Drunmode=<runmode>


